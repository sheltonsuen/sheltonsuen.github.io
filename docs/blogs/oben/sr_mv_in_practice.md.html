<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-6e20702d1fdd0ee7.js" defer=""></script><script src="/_next/static/chunks/framework-0bff4c72fef67389.js" defer=""></script><script src="/_next/static/chunks/main-4abec45f7c95ce5e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1df1ee81c516dd4b.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/%5B...names%5D-2e012eacd3022c9d.js" defer=""></script><script src="/_next/static/6Fi7gkGyxjjgFbI9lTO1M/_buildManifest.js" defer=""></script><script src="/_next/static/6Fi7gkGyxjjgFbI9lTO1M/_ssgManifest.js" defer=""></script><script src="/_next/static/6Fi7gkGyxjjgFbI9lTO1M/_middlewareManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.3">body{margin:0;padding:0;box-sizing:border-box;}/*!sc*/
#__next{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}/*!sc*/
data-styled.g1[id="sc-global-ejORCz1"]{content:"sc-global-ejORCz1,"}/*!sc*/
.cRaYml{width:100%;height:100%;vertical-align:middle;border-radius:50%;}/*!sc*/
data-styled.g2[id="Avatar__Img-sc-j2rhp9-0"]{content:"cRaYml,"}/*!sc*/
.itjVmX{padding:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;list-style:none;border-bottom:1px solid #cacfd2;}/*!sc*/
data-styled.g3[id="HeaderMenu__MenuWrapper-sc-14dkklk-0"]{content:"itjVmX,"}/*!sc*/
.kIlpOB{line-height:32px;min-width:96px;text-align:center;border-bottom:none;}/*!sc*/
.bNdHDE{line-height:32px;min-width:96px;text-align:center;border-bottom:2px solid #EB984E;}/*!sc*/
data-styled.g4[id="HeaderMenu__MenuItem-sc-14dkklk-1"]{content:"kIlpOB,bNdHDE,"}/*!sc*/
.dGCYZo{-webkit-text-decoration:none;text-decoration:none;color:#24292f;}/*!sc*/
data-styled.g5[id="HeaderMenu__Link-sc-14dkklk-2"]{content:"dGCYZo,"}/*!sc*/
.bmDBta{margin:0;padding:32px 16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;width:1280px;}/*!sc*/
data-styled.g6[id="PageWrapper__Wrapper-sc-859ve4-0"]{content:"bmDBta,"}/*!sc*/
.Kjbfq{width:256px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:column nowrap;-ms-flex-flow:column nowrap;flex-flow:column nowrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
@media (max-width:768px){.Kjbfq{display:none;}}/*!sc*/
data-styled.g7[id="PageWrapper__SideBarWrapper-sc-859ve4-1"]{content:"Kjbfq,"}/*!sc*/
.ikqffP{-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:column nowrap;-ms-flex-flow:column nowrap;flex-flow:column nowrap;}/*!sc*/
data-styled.g9[id="PageWrapper__MainContentWrapper-sc-859ve4-3"]{content:"ikqffP,"}/*!sc*/
.jeBpnd{width:128px;height:128px;margin:32px 0 8px 0;}/*!sc*/
data-styled.g10[id="PageWrapper__StyledAvatar-sc-859ve4-4"]{content:"jeBpnd,"}/*!sc*/
.jIJyRi{margin-bottom:4px;font-size:1.6rem;}/*!sc*/
data-styled.g11[id="PageWrapper__Name-sc-859ve4-5"]{content:"jIJyRi,"}/*!sc*/
</style></head><body><div id="__next" data-reactroot=""><div class="PageWrapper__Wrapper-sc-859ve4-0 bmDBta"><div class="PageWrapper__SideBarWrapper-sc-859ve4-1 Kjbfq"><img class="Avatar__Img-sc-j2rhp9-0 cRaYml PageWrapper__StyledAvatar-sc-859ve4-4 jeBpnd" src="/avatar.jpeg"/><span class="PageWrapper__Name-sc-859ve4-5 jIJyRi">孙晓聪</span></div><div class="PageWrapper__MainContentWrapper-sc-859ve4-3 ikqffP"><menu class="HeaderMenu__MenuWrapper-sc-14dkklk-0 itjVmX"><li class="HeaderMenu__MenuItem-sc-14dkklk-1 kIlpOB"><a href="/" class="HeaderMenu__Link-sc-14dkklk-2 dGCYZo">最新</a></li><li selected="" class="HeaderMenu__MenuItem-sc-14dkklk-1 bNdHDE"><a href="/blogs" class="HeaderMenu__Link-sc-14dkklk-2 dGCYZo">博客</a></li><li class="HeaderMenu__MenuItem-sc-14dkklk-1 kIlpOB"><a href="/readings" class="HeaderMenu__Link-sc-14dkklk-2 dGCYZo">书评</a></li></menu><div class="PageWrapper__ContentWrapper-sc-859ve4-2 gUefAE"><div><h1>SR 实践</h1>
<h2>背景</h2>
<p>首先介绍一下我们团队的情况，我司数据中台团队成立于2022年初，最开始聚焦于离线数仓和报表，人员配置在6个人左右的小团队。技术架构比较复杂，组件相对来说比较臃肿，一次报表刷新的时间大概在12小时左右，在我们数据量并不是特别大的情况下效率并不高。2023年年末团队经历一波换血过后，我们就开始着手整个数据中台的架构治理。治理包括基于SR 将 Doris和Hadoop 整合为一个数仓，然后通过Flink CDC 将所有的原表直接load到数仓。</p>
<h2>StarRocks</h2>
<p>StarRocks 是新一代极速全场景 MPP (Massively Parallel Processing) 数据库。StarRocks 的愿景是能够让用户的数据分析变得更加简单和敏捷。用户无需经过复杂的预处理，就可以用 StarRocks 来支持多种数据分析场景的极速分析。StarRocks 架构简洁，采用了全面向量化引擎，并配备全新设计的 CBO (Cost Based Optimizer) 优化器，查询速度（尤其是多表关联查询）远超同类产品。StarRocks 能很好地支持实时数据分析，并能实现对实时更新数据的高效查询。StarRocks 还支持现代化物化视图，进一步加速查询。使用 StarRocks，用户可以灵活构建包括大宽表、星型模型、雪花模型在内的各类模型。</p>
<h2>整体架构</h2>
<p><img src="https://sheltonsuen.github.io/dp_arch.jpg" alt="dp arch"></p>
<h2>案例</h2>
<h3>1. DAU 计算</h3>
<p>我们直接通过Flink CDC 3.0 的 Pipeline 将需要的表实时导入到 StarRocks 的 ods 层，然后再通过构建异步物化视图，实时计算各种DAU。</p>
<h4>需要注意的是</h4>
<ul>
<li>StarRocks对于性能的消耗还是显而易见的，我们最初就因为机器性能原因，经常在所有物化视图刷新的时候导致整个集群崩溃。</li>
<li>设置监控和告警，以防物化视图失败时没有感知， 包括Flink CDC 3.0 的监控和告警，我们曾经多次遇到上游数据结构改变导致Flink CDC 断掉。</li>
</ul>
<h2>整体使用感受</h2>
<p>StarRocks 作为一个MPP引擎，在我们的架构治理中起到了关键作用，效果也是显而易见的，优化过后我们的数据刷新时间从原来的12小时缩短为20分钟，由于我们没有增量的必要，
每次直接依赖于StarRocks的计算能力，暴力刷新所有的表。并且新版的StarRocks 支持存算分离，结合云厂商的廉价存储和SSD缓存，稳定性得到进一步提升。</p>
</div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"blog":{"name":"sr_mv_in_practice.md","categories":["oben"],"content":"\n# SR 实践\n\n## 背景\n首先介绍一下我们团队的情况，我司数据中台团队成立于2022年初，最开始聚焦于离线数仓和报表，人员配置在6个人左右的小团队。技术架构比较复杂，组件相对来说比较臃肿，一次报表刷新的时间大概在12小时左右，在我们数据量并不是特别大的情况下效率并不高。2023年年末团队经历一波换血过后，我们就开始着手整个数据中台的架构治理。治理包括基于SR 将 Doris和Hadoop 整合为一个数仓，然后通过Flink CDC 将所有的原表直接load到数仓。 \n\n## StarRocks\nStarRocks 是新一代极速全场景 MPP (Massively Parallel Processing) 数据库。StarRocks 的愿景是能够让用户的数据分析变得更加简单和敏捷。用户无需经过复杂的预处理，就可以用 StarRocks 来支持多种数据分析场景的极速分析。StarRocks 架构简洁，采用了全面向量化引擎，并配备全新设计的 CBO (Cost Based Optimizer) 优化器，查询速度（尤其是多表关联查询）远超同类产品。StarRocks 能很好地支持实时数据分析，并能实现对实时更新数据的高效查询。StarRocks 还支持现代化物化视图，进一步加速查询。使用 StarRocks，用户可以灵活构建包括大宽表、星型模型、雪花模型在内的各类模型。\n\n## 整体架构\n![dp arch](https://sheltonsuen.github.io/dp_arch.jpg) \n\n## 案例\n\n### 1. DAU 计算\n我们直接通过Flink CDC 3.0 的 Pipeline 将需要的表实时导入到 StarRocks 的 ods 层，然后再通过构建异步物化视图，实时计算各种DAU。\n\n#### 需要注意的是\n* StarRocks对于性能的消耗还是显而易见的，我们最初就因为机器性能原因，经常在所有物化视图刷新的时候导致整个集群崩溃。\n* 设置监控和告警，以防物化视图失败时没有感知， 包括Flink CDC 3.0 的监控和告警，我们曾经多次遇到上游数据结构改变导致Flink CDC 断掉。\n\n## 整体使用感受\nStarRocks 作为一个MPP引擎，在我们的架构治理中起到了关键作用，效果也是显而易见的，优化过后我们的数据刷新时间从原来的12小时缩短为20分钟，由于我们没有增量的必要，\n每次直接依赖于StarRocks的计算能力，暴力刷新所有的表。并且新版的StarRocks 支持存算分离，结合云厂商的廉价存储和SSD缓存，稳定性得到进一步提升。\n","meta":{"title":"SR MV 实践","date":"Wed Oct 09 2024 00:00:00 GMT+0000 (Coordinated Universal Time)","tags":"oben","private":false}},"html":"\u003ch1\u003eSR 实践\u003c/h1\u003e\n\u003ch2\u003e背景\u003c/h2\u003e\n\u003cp\u003e首先介绍一下我们团队的情况，我司数据中台团队成立于2022年初，最开始聚焦于离线数仓和报表，人员配置在6个人左右的小团队。技术架构比较复杂，组件相对来说比较臃肿，一次报表刷新的时间大概在12小时左右，在我们数据量并不是特别大的情况下效率并不高。2023年年末团队经历一波换血过后，我们就开始着手整个数据中台的架构治理。治理包括基于SR 将 Doris和Hadoop 整合为一个数仓，然后通过Flink CDC 将所有的原表直接load到数仓。\u003c/p\u003e\n\u003ch2\u003eStarRocks\u003c/h2\u003e\n\u003cp\u003eStarRocks 是新一代极速全场景 MPP (Massively Parallel Processing) 数据库。StarRocks 的愿景是能够让用户的数据分析变得更加简单和敏捷。用户无需经过复杂的预处理，就可以用 StarRocks 来支持多种数据分析场景的极速分析。StarRocks 架构简洁，采用了全面向量化引擎，并配备全新设计的 CBO (Cost Based Optimizer) 优化器，查询速度（尤其是多表关联查询）远超同类产品。StarRocks 能很好地支持实时数据分析，并能实现对实时更新数据的高效查询。StarRocks 还支持现代化物化视图，进一步加速查询。使用 StarRocks，用户可以灵活构建包括大宽表、星型模型、雪花模型在内的各类模型。\u003c/p\u003e\n\u003ch2\u003e整体架构\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"https://sheltonsuen.github.io/dp_arch.jpg\" alt=\"dp arch\"\u003e\u003c/p\u003e\n\u003ch2\u003e案例\u003c/h2\u003e\n\u003ch3\u003e1. DAU 计算\u003c/h3\u003e\n\u003cp\u003e我们直接通过Flink CDC 3.0 的 Pipeline 将需要的表实时导入到 StarRocks 的 ods 层，然后再通过构建异步物化视图，实时计算各种DAU。\u003c/p\u003e\n\u003ch4\u003e需要注意的是\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eStarRocks对于性能的消耗还是显而易见的，我们最初就因为机器性能原因，经常在所有物化视图刷新的时候导致整个集群崩溃。\u003c/li\u003e\n\u003cli\u003e设置监控和告警，以防物化视图失败时没有感知， 包括Flink CDC 3.0 的监控和告警，我们曾经多次遇到上游数据结构改变导致Flink CDC 断掉。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e整体使用感受\u003c/h2\u003e\n\u003cp\u003eStarRocks 作为一个MPP引擎，在我们的架构治理中起到了关键作用，效果也是显而易见的，优化过后我们的数据刷新时间从原来的12小时缩短为20分钟，由于我们没有增量的必要，\n每次直接依赖于StarRocks的计算能力，暴力刷新所有的表。并且新版的StarRocks 支持存算分离，结合云厂商的廉价存储和SSD缓存，稳定性得到进一步提升。\u003c/p\u003e\n"},"__N_SSG":true},"page":"/blogs/[...names]","query":{"names":["oben","sr_mv_in_practice.md"]},"buildId":"6Fi7gkGyxjjgFbI9lTO1M","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>